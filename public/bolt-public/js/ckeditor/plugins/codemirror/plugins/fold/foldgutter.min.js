!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],t):t(CodeMirror)}(function(u){"use strict";u.defineOption("foldGutter",!1,function(t,o,e){e&&e!=u.Init&&(t.clearGutter(t.state.foldGutter.options.gutter),t.state.foldGutter=null,t.off("gutterClick",i),t.off("change",f),t.off("viewportChange",d),t.off("fold",c),t.off("unfold",c),t.off("swapDoc",r)),o&&(t.state.foldGutter=new function(t){this.options=t,this.from=this.to=0}(function(t){!0===t&&(t={});null==t.gutter&&(t.gutter="CodeMirror-foldgutter");null==t.indicatorOpen&&(t.indicatorOpen="CodeMirror-foldgutter-open");null==t.indicatorFolded&&(t.indicatorFolded="CodeMirror-foldgutter-folded");return t}(o)),r(t),t.on("gutterClick",i),t.on("change",f),t.on("viewportChange",d),t.on("fold",c),t.on("unfold",c),t.on("swapDoc",r))});var a=u.Pos;function l(t){if("string"==typeof t){var o=document.createElement("div");return o.className=t+" CodeMirror-guttermarker-subtle",o}return t.cloneNode(!0)}function n(i,t,o){var f=i.state.foldGutter.options,d=t;i.eachLine(t,o,function(t){var o=null;if(function(t,o){for(var e=t.findMarksAt(a(o)),r=0;r<e.length;++r)if(e[r].__isFold&&e[r].find().from.line==o)return!0}(i,d))o=l(f.indicatorFolded);else{var e=a(d,0),r=f.rangeFinder||u.fold.auto,n=r&&r(i,e);n&&n.from.line+1<n.to.line&&(o=l(f.indicatorOpen))}i.setGutterMarker(t,f.gutter,o),++d})}function r(t){var o=t.getViewport(),e=t.state.foldGutter;e&&(t.operation(function(){n(t,o.from,o.to)}),e.from=o.from,e.to=o.to)}function i(t,o,e){var r=t.state.foldGutter.options;e==r.gutter&&t.foldCode(a(o,0),r.rangeFinder)}function f(t){var o=t.state.foldGutter,e=t.state.foldGutter.options;o.from=o.to=0,clearTimeout(o.changeUpdate),o.changeUpdate=setTimeout(function(){r(t)},e.foldOnChangeTimeSpan||600)}function d(o){var e=o.state.foldGutter,t=o.state.foldGutter.options;clearTimeout(e.changeUpdate),e.changeUpdate=setTimeout(function(){var t=o.getViewport();e.from==e.to||20<t.from-e.to||20<e.from-t.to?r(o):o.operation(function(){t.from<e.from&&(n(o,t.from,e.from),e.from=t.from),t.to>e.to&&(n(o,e.to,t.to),e.to=t.to)})},t.updateViewportTimeSpan||400)}function c(t,o){var e=t.state.foldGutter,r=o.line;r>=e.from&&r<e.to&&n(t,r,r+1)}});