!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(r){var s=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),g=r.Pos,p={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function u(e,t,n){var r=e.getLineHandle(t.line),i=t.ch-1,o=n&&n.afterCursor;null==o&&(o=/(^| )cm-fat-cursor($| )/.test(e.getWrapperElement().className));var a=!o&&0<=i&&p[r.text.charAt(i)]||p[r.text.charAt(++i)];if(!a)return null;var c=">"==a.charAt(1)?1:-1;if(n&&n.strict&&0<c!=(i==t.ch))return null;var l=e.getTokenTypeAt(g(t.line,i+1)),f=h(e,g(t.line,i+(0<c?1:0)),c,l||null,n);return null==f?null:{from:g(t.line,i),to:f&&f.pos,match:f&&f.ch==a.charAt(0),forward:0<c}}function h(e,t,n,r,i){for(var o=i&&i.maxScanLineLength||1e4,a=i&&i.maxScanLines||1e3,c=[],l=i&&i.bracketRegex?i.bracketRegex:/[(){}[\]]/,f=0<n?Math.min(t.line+a,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-a),s=t.line;s!=f;s+=n){var u=e.getLine(s);if(u){var h=0<n?0:u.length-1,m=0<n?u.length:-1;if(!(u.length>o))for(s==t.line&&(h=t.ch-(n<0?1:0));h!=m;h+=n){var d=u.charAt(h);if(l.test(d)&&(void 0===r||e.getTokenTypeAt(g(s,h+1))==r))if(">"==p[d].charAt(1)==0<n)c.push(d);else{if(!c.length)return{pos:g(s,h),ch:d};c.pop()}}}}return s-n!=(0<n?e.lastLine():e.firstLine())&&null}function t(e,t,n){for(var r=e.state.matchBrackets.maxHighlightLineLength||1e3,i=[],o=e.listSelections(),a=0;a<o.length;a++){var c=o[a].empty()&&u(e,o[a].head,n);if(c&&e.getLine(c.from.line).length<=r){var l=c.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";i.push(e.markText(c.from,g(c.from.line,c.from.ch+1),{className:l})),c.to&&e.getLine(c.to.line).length<=r&&i.push(e.markText(c.to,g(c.to.line,c.to.ch+1),{className:l}))}}if(i.length){s&&e.state.focused&&e.focus();var f=function(){e.operation(function(){for(var e=0;e<i.length;e++)i[e].clear()})};if(!t)return f;setTimeout(f,800)}}var i=null;function o(e){e.operation(function(){i&&(i(),i=null),i=t(e,!1,e.state.matchBrackets)})}r.defineOption("matchBrackets",!1,function(e,t,n){n&&n!=r.Init&&(e.off("cursorActivity",o),i&&(i(),i=null)),t&&(e.state.matchBrackets="object"==typeof t?t:{},e.on("cursorActivity",o))}),r.defineExtension("matchBrackets",function(){t(this,!0)}),r.defineExtension("findMatchingBracket",function(e,t,n){return(n||"boolean"==typeof t)&&(n?(n.strict=t,t=n):t=t?{strict:!0}:null),u(this,e,t)}),r.defineExtension("scanForBracket",function(e,t,n,r){return h(this,e,t,n,r)})});