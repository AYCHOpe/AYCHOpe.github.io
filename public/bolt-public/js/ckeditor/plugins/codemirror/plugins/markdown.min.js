!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror",require("../xml/xml"))):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml"],t):t(CodeMirror)}(function(z){"use strict";z.defineMode("markdown",function(l,p){var i=z.modes.hasOwnProperty("xml"),k=z.getMode(l,i?{name:"xml",htmlMode:!0}:"text/plain"),s={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},o=function(){var t,e={},n={},i=[];for(var r in z.modes)z.modes.propertyIsEnumerable(r)&&i.push(r);for(t=0;t<i.length;t++)e[i[t]]=i[t];var a=[];for(var r in z.mimeModes)z.mimeModes.propertyIsEnumerable(r)&&a.push({mime:r,mode:z.mimeModes[r]});for(t=0;t<a.length;t++)n[a[t].mime]=a[t].mime;for(var o in s)(s[o]in e||s[o]in n)&&(e[o]=s[o]);return function(t){return e[t]?z.getMode(l,e[t]):null}}();void 0===p.highlightFormatting&&(p.highlightFormatting=!1),void 0===p.maxBlockquoteDepth&&(p.maxBlockquoteDepth=0),void 0===p.underscoresBreakWords&&(p.underscoresBreakWords=!0),void 0===p.fencedCodeBlocks&&(p.fencedCodeBlocks=!1),void 0===p.taskLists&&(p.taskLists=!1);var v=0,r="header",h="comment",a="quote",f="variable-2",c="variable-3",m="keyword",g="hr",x="tag",u="formatting",S="link",L="link",d="link",b="string",F="em",M="strong",q=/^([*\-=_])(?:\s*\1){2,}\s*$/,w=/^[*\-+]\s+/,C=/^[0-9]+\.\s+/,D=/^\[(x| )\](?=\s)/,H=/^#+/,T=/^(?:\={1,}|-{1,})$/,n=/^[^#!\[\]*_\\<>` "'(]+/;function y(t,e,n){return e.f=e.inline=n,n(t,e)}function B(t,e,n){return e.f=e.block=n,n(t,e)}function j(t){return t.linkTitle=!1,t.em=!1,t.strong=!1,t.quote=0,i||t.f!=$||(t.f=O,t.block=_),t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.thisLineHasContent=!1,null}function _(t,e){var n=t.sol(),i=!1!==e.list;!1!==e.list&&0<=e.indentationDiff?(e.indentationDiff<4&&(e.indentation-=e.indentationDiff),e.list=null):!1!==e.list&&0<e.indentation?(e.list=null,e.listDepth=Math.floor(e.indentation/4)):!1!==e.list&&(e.list=!1,e.listDepth=0);var r=null;if(4<=e.indentationDiff)return e.indentation-=4,t.skipToEnd(),h;if(t.eatSpace())return null;if(r=t.match(H))return e.header=r[0].length<=6?r[0].length:6,p.highlightFormatting&&(e.formatting="header"),e.f=e.inline,N(e);if(e.prevLineHasContent&&(r=t.match(T)))return e.header="="==r[0].charAt(0)?1:2,p.highlightFormatting&&(e.formatting="header"),e.f=e.inline,N(e);if(t.eat(">"))return e.indentation++,e.quote=n?1:e.quote+1,p.highlightFormatting&&(e.formatting="quote"),t.eatSpace(),N(e);if("["===t.peek())return y(t,e,R);if(t.match(q,!0))return g;if((!e.prevLineHasContent||i)&&(t.match(w,!1)||t.match(C,!1))){var a=null;return t.match(w,!0)?a="ul":(t.match(C,!0),a="ol"),e.indentation+=4,e.list=!0,e.listDepth++,p.taskLists&&t.match(D,!1)&&(e.taskList=!0),e.f=e.inline,p.highlightFormatting&&(e.formatting=["list","list-"+a]),N(e)}return p.fencedCodeBlocks&&t.match(/^```([\w+#]*)/,!0)?(e.localMode=o(RegExp.$1),e.localMode&&(e.localState=e.localMode.startState()),B(t,e,E),p.highlightFormatting&&(e.formatting="code-block"),e.code=!0,N(e)):y(t,e,e.inline)}function $(t,e){var n=k.token(t,e.htmlState);return(i&&null===e.htmlState.tagStart&&!e.htmlState.context||e.md_inside&&-1<t.current().indexOf(">"))&&(e.f=O,e.block=_,e.htmlState=null),n}function E(t,e){if(t.sol()&&t.match(/^```/,!0)){e.localMode=e.localState=null,e.f=O,e.block=_,p.highlightFormatting&&(e.formatting="code-block"),e.code=!0;var n=N(e);return e.code=!1,n}return e.localMode?e.localMode.token(t,e.localState):(t.skipToEnd(),h)}function N(t){var e=[];if(t.formatting){e.push(u),"string"==typeof t.formatting&&(t.formatting=[t.formatting]);for(var n=0;n<t.formatting.length;n++)e.push(u+"-"+t.formatting[n]),"header"===t.formatting[n]&&e.push(u+"-"+t.formatting[n]+"-"+t.header),"quote"===t.formatting[n]&&(!p.maxBlockquoteDepth||p.maxBlockquoteDepth>=t.quote?e.push(u+"-"+t.formatting[n]+"-"+t.quote):e.push("error"))}if(t.taskOpen)return e.push("meta"),e.length?e.join(" "):null;if(t.taskClosed)return e.push("property"),e.length?e.join(" "):null;if(t.linkHref)return e.push(b),e.length?e.join(" "):null;if(t.strong&&e.push(M),t.em&&e.push(F),t.linkText&&e.push(d),t.code&&e.push(h),t.header&&(e.push(r),e.push(r+"-"+t.header)),t.quote&&(e.push(a),!p.maxBlockquoteDepth||p.maxBlockquoteDepth>=t.quote?e.push(a+"-"+t.quote):e.push(a+"-"+p.maxBlockquoteDepth)),!1!==t.list){var i=(t.listDepth-1)%3;i?1===i?e.push(c):e.push(m):e.push(f)}return t.trailingSpaceNewLine?e.push("trailing-space-new-line"):t.trailingSpace&&e.push("trailing-space-"+(t.trailingSpace%2?"a":"b")),e.length?e.join(" "):null}function t(t,e){if(t.match(n,!0))return N(e)}function O(t,e){var n=e.text(t,e);if(void 0!==n)return n;if(e.list)return e.list=null,N(e);if(e.taskList)return"x"!==t.match(D,!0)[1]?e.taskOpen=!0:e.taskClosed=!0,p.highlightFormatting&&(e.formatting="task"),e.taskList=!1,N(e);if(e.taskOpen=!1,e.taskClosed=!1,e.header&&t.match(/^#+$/,!0))return p.highlightFormatting&&(e.formatting="header"),N(e);var i=t.sol(),r=t.next();if(e.escape)return e.escape=!1,N(e);if("\\"===r)return p.highlightFormatting&&(e.formatting="escape"),e.escape=!0,N(e);if(e.linkTitle){e.linkTitle=!1;var a=r;"("===r&&(a=")");var o="^\\s*(?:[^"+(a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"))+"\\\\]+|\\\\\\\\|\\\\.)"+a;if(t.match(new RegExp(o),!0))return b}if("`"===r){var l=e.formatting;p.highlightFormatting&&(e.formatting="code");var s=N(e),h=t.pos;t.eatWhile("`");var f=1+t.pos-h;return e.code?f===v?(e.code=!1,s):(e.formatting=l,N(e)):(v=f,e.code=!0,N(e))}if(e.code)return N(e);if("!"===r&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return t.match(/\[[^\]]*\]/),e.inline=e.f=I,x;if("["===r&&t.match(/.*\](\(| ?\[)/,!1))return e.linkText=!0,p.highlightFormatting&&(e.formatting="link"),N(e);if("]"===r&&e.linkText){p.highlightFormatting&&(e.formatting="link");var c=N(e);return e.linkText=!1,e.inline=e.f=I,c}if("<"===r&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return e.f=e.inline=W,p.highlightFormatting&&(e.formatting="link"),(c=N(e))?c+=" ":c="",c+S;if("<"===r&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return e.f=e.inline=W,p.highlightFormatting&&(e.formatting="link"),(c=N(e))?c+=" ":c="",c+L;if("<"===r&&t.match(/^\w/,!1)){if(-1!=t.string.indexOf(">")){var m=t.string.substring(1,t.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(m)&&(e.md_inside=!0)}return t.backUp(1),e.htmlState=z.startState(k),B(t,e,$)}if("<"===r&&t.match(/^\/\w*?>/))return e.md_inside=!1,"tag";var g=!1;if(!p.underscoresBreakWords&&"_"===r&&"_"!==t.peek()&&t.match(/(\w)/,!1)){var u=t.pos-2;if(0<=u){var d=t.string.charAt(u);"_"!==d&&d.match(/(\w)/,!1)&&(g=!0)}}if("*"===r||"_"===r&&!g)if(i&&" "===t.peek());else{if(e.strong===r&&t.eat(r)){p.highlightFormatting&&(e.formatting="strong");s=N(e);return e.strong=!1,s}if(!e.strong&&t.eat(r))return e.strong=r,p.highlightFormatting&&(e.formatting="strong"),N(e);if(e.em===r){p.highlightFormatting&&(e.formatting="em");s=N(e);return e.em=!1,s}if(!e.em)return e.em=r,p.highlightFormatting&&(e.formatting="em"),N(e)}else if(" "===r&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return N(e);t.backUp(1)}return" "===r&&(t.match(/ +$/,!1)?e.trailingSpace++:e.trailingSpace&&(e.trailingSpaceNewLine=!0)),N(e)}function W(t,e){if(">"===t.next()){e.f=e.inline=O,p.highlightFormatting&&(e.formatting="link");var n=N(e);return n?n+=" ":n="",n+S}return t.match(/^[^>]+/,!0),S}function I(t,e){if(t.eatSpace())return null;var a,n=t.next();return"("===n||"["===n?(e.f=e.inline=(a="("===n?")":"]",function(t,e){var n,i=t.next();if(i===a){e.f=e.inline=O,p.highlightFormatting&&(e.formatting="link-string");var r=N(e);return e.linkHref=!1,r}return t.match((P[n=a]||(n=(n+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),P[n]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+n+")")),P[n]),!0)&&t.backUp(1),e.linkHref=!0,N(e)}),p.highlightFormatting&&(e.formatting="link-string"),e.linkHref=!0,N(e)):"error"}function R(t,e){return t.match(/^[^\]]*\]:/,!1)?(e.f=U,t.next(),p.highlightFormatting&&(e.formatting="link"),e.linkText=!0,N(e)):y(t,e,O)}function U(t,e){if(t.match(/^\]:/,!0)){e.f=e.inline=A,p.highlightFormatting&&(e.formatting="link");var n=N(e);return e.linkText=!1,n}return t.match(/^[^\]]+/,!0),d}function A(t,e){return t.eatSpace()?null:(t.match(/^[^\s]+/,!0),void 0===t.peek()?e.linkTitle=!0:t.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),e.f=e.inline=O,b)}var P=[];var e={startState:function(){return{f:_,prevLineHasContent:!1,thisLineHasContent:!1,block:_,htmlState:null,indentation:0,inline:O,text:t,escape:!1,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(t){return{f:t.f,prevLineHasContent:t.prevLineHasContent,thisLineHasContent:t.thisLineHasContent,block:t.block,htmlState:t.htmlState&&z.copyState(k,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?z.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,escape:!1,formatting:!1,linkTitle:t.linkTitle,em:t.em,strong:t.strong,header:t.header,taskList:t.taskList,list:t.list,listDepth:t.listDepth,quote:t.quote,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside}},token:function(t,e){if(e.formatting=!1,t.sol()){var n=t.match(/^\s*$/,!0)||e.header;if(e.header=0,n)return e.prevLineHasContent=!1,j(e);e.prevLineHasContent=e.thisLineHasContent,e.thisLineHasContent=!0,e.escape=!1,e.taskList=!1,e.code=!1,e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.f=e.block;var i=t.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,r=4*Math.floor((i-e.indentation)/4);4<r&&(r=4);var a=e.indentation+r;if(e.indentationDiff=a-e.indentation,e.indentation=a,0<i)return null}var o=e.f(t,e);return t.start==t.pos?this.token(t,e):o},innerMode:function(t){return t.block==$?{state:t.htmlState,mode:k}:t.localState?{state:t.localState,mode:t.localMode}:{state:t,mode:e}},blankLine:j,getType:N,fold:"markdown"};return e},"xml"),z.defineMIME("text/x-markdown","markdown")});