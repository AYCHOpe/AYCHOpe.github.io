{#
    This include automagically loads the correct module from the modules folder.
    This should not be edited.
#}
{% spaceless %}
{% set title = module.get('title') %}
{% set subtitle = module.get('subtitle') %}
{% set body = module.get('body') %}
{% set template = module.get('templates') %}
{% set templatefile = 'modules/_' ~ template ~ '.twig' %}
{% set ordering = module.get('ordering') %}
{% set sources = module.get('sources') %}
{% set override_amount = module.get('override_amount') %}

{% set selected_records = [] %}
{% if template != 'body' and ordering == 'specified' %}
    {% set field = 'selected_' ~ sources %}
    {% set ids = module.get(field) %}
    {% if ids is iterable %}
        {% for id in ids %}
            {% set contentquery = sources ~ '/' ~ id %}
            {% setcontent record = contentquery returnsingle %}
            {% set selected_records = selected_records|merge([record]) %}
        {% endfor %}
        {% set allow_pager = false %}
    {% endif %}
{% elseif template != 'body' and ordering == 'random' %}
    {% set contentquery = sources ~ '/' ~ ordering ~ '/' ~ override_amount|default(10) %}
    {% setcontent selected_records = contentquery %}
    {% set allow_pager = false %}
{% elseif template != 'body' %}
    {% set allow_pager = true %}
    {% if sources == 'persons'  %}
        {% set filtername = 'network_participation' %}
        {% set filtervalue = module.get('filter_persons') %}
    {% elseif sources == 'posts' %}
        {% set filtername = 'posttype' %}
        {% set filtervalue = module.get('filter_posts') %}
    {% elseif sources == 'data' %}
        {% set filtername = 'datatype' %}
        {% set filtervalue = module.get('filter_data') %}
    {% elseif sources == 'projects' %}
        {% set filtername = 'projecttype' %}
        {% set filtervalue = module.get('filter_projects') %}
    {% else %}
        {% set filtername = 1 %}
        {% set filtervalue = 1 %}
    {% endif %}

    {% if ordering == 'latest' %}
        {% setcontent selected_records = sources where {(filtername): (filtervalue)} orderby '-datepublish' limit override_amount|default(10) allowpaging  %}
    {% elseif ordering == 'latest_unpaged' %}
        {% setcontent selected_records = sources where {(filtername): (filtervalue)} orderby '-datepublish' limit override_amount|default(10) %}
        {% set allow_pager = false %}
    {% elseif ordering == 'oldest' %}
        {% setcontent selected_records = sources where {(filtername): (filtervalue)} orderby 'datepublish' limit override_amount|default(10) allowpaging %}
    {% elseif ordering == 'oldest_unpaged' %}
        {% setcontent selected_records = sources where {(filtername): (filtervalue)} orderby 'datepublish' limit override_amount|default(10) %}
        {% set allow_pager = false %}
    {% elseif ordering == 'alphabetical' %}
        {% if sources != 'persons' %}
            {% setcontent selected_records = sources where { (filtername): '%' ~ (filtervalue) ~'%' } orderby 'title' limit override_amount|default(10) allowpaging  %}
        {% else %}
            {% setcontent selected_records = sources where { (filtername): '%' ~ (filtervalue) ~'%' } orderby 'last_name' limit override_amount|default(10) allowpaging  %}
        {% endif %}
    {% elseif ordering == 'tag' %}
        {% set basetag = module.get('basetag') %}
        {% setcontent selected_records = sources where {(filtername): (filtervalue), tags: basetag} orderby '-datepublish' limit override_amount|default(10) allowpaging  %}
    {% elseif ordering == 'tag_unpaged' %}
        {% set basetag = module.get('basetag') %}
        {% setcontent selected_records = sources where {(filtername): (filtervalue), tags: basetag} orderby '-datepublish' limit override_amount|default(10)  %}
        {% set allow_pager = false %}
    {% elseif ordering == 'category' %}
        {% set basecategory = module.get('basecategory') %}
        {% setcontent selected_records = sources where {(filtername): (filtervalue), categories: basecategory} orderby '-datepublish' limit override_amount|default(10) allowpaging  %}
    {% elseif ordering == 'category_unpaged' %}
        {% set basecategory = module.get('basecategory') %}
        {% setcontent selected_records = sources where {(filtername): (filtervalue), categories: basecategory} orderby '-datepublish' limit override_amount|default(10)  %}
        {% set allow_pager = false %}
    {% elseif ordering == 'calendar' %}
        {{ dump(module, template, ordering, override_amount) }}
    {% elseif ordering == 'calendar_upcoming' %}
        {{ dump(module, template, ordering, override_amount) }}
    {% elseif ordering == 'calendar_archive' %}
        {{ dump(module, template, ordering, override_amount) }}
    {% else %}
        {{ dump(module, template, ordering, override_amount) }}
    {% endif %}
{% else %}
    {% set allow_pager = false %}
{% endif %}
{% endspaceless %}
<!-- loading templatefile for module: '{{ templatefile }}' or 'modules/_default.twig' -->
{# automatically load module template #}
{% include [templatefile, 'modules/_default.twig'] with {
    'module': module,
    'title': title,
    'body': body,
    'records': selected_records,
    'allow_pager': allow_pager
} %}
