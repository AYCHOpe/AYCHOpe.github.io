{#
Patternlab links:
n/a
#}
{% extends '_base_page.twig' %}

{% block bodyclass %} page_entry_detail {% endblock %}

{% if is_member() %}
    {% set member = member() %}
    {% set member_meta = member_meta() %}
{% endif %}

{% block main %}
{% if is_member() %}
<!-- Start content -->
<div class="l-content">

    <div class="page_header">

    {% include 'items/_item-breadcrumb.twig' %}

    </div>

    <div id="entry-detail" class="entry-detail">
        <div class="section">

            {# use the current entry from the url get #}
            {% set currententryid = request('id') %}

            {% if is_member() and is_judge %}
                {% setcontent himentry = 'himentries' where { 'id': currententryid, status: '!' } %}
                {% set currentuser = { 'id': himentry.userid, 'name': himentry.name, 'email': himentry.email } %}


                <div class="user-banner-inline">
                    Hello {{ member.displayname }}. You can rate the entry below.
                </div>
            {% else %}
                {# use the current user from the members extension #}
                {% set currentuser = { 'id': member.guid|default(1), 'name': member.displayname|default('Rick'), 'email': member.email|default('rick@browsercheck.nl') } %}
                {% setcontent himentry = 'himentries' where { 'userid': currentuser.id, 'id': currententryid, status: '!' } %}
            {% endif %}
            {#{% dump(himentry) %}#}

            {% if himentry.videolink %}
                <!-- <div class="video-fluid"> -->
                    <a class="embedly-card" href="{{ himentry.videolink }}" data-card-width="100%" data-card-controls="0" data-card-theme="dark" data-card-chrome="0">{{ himentry.title }}</a>
                <!-- </div> -->
            {% endif %}

            <div class="cf entry-info">
                <!-- Entry meta data -->
                <div class="entry-data">

                    {% if himentry.upload_images is not empty %}
                        {% set first = himentry.upload_images|first %}
                        <img src="{{ image(first.filename, 640, 360) }}" alt="{{ first.title }} - thumbnail" />
                    {% else %}
                        {% set videodata = getvideodata( himentry.videolink ) %}
                        {#{{ dump(videodata) }}#}
                        {% if videodata.type == 'youtube' %}
                            <img src="https://img.youtube.com/vi/{{ videodata.video_id }}/mqdefault.jpg" alt="{{ himentry.title }} - thumbnail" />
                        {% else %}
                            <span class="no-image">No image for {{ videodata.type }}</span>
                        {% endif %}
                    {% endif %}

                    <div class="entry-data-inner">
                        <ul>
                            <li class="credits">
                                {% if himentry.credits is defined  %}
                                    <div>{{ himentry.credits|striptags|nl2br }}</div>
                                {% else %}
                                    <div><p>No credits yet.</p></div>
                                {% endif %}
                            </li>

                            <li><a href="{{ himentry.projecturl }}">{{ himentry.projecturl }}</a></li>
                        </ul>
                    </div>

                </div>


                <div class="entry-text prose">

                    <h2>{{ himentry.title }}</h2>

                    {% if himentry.summary is defined  %}
                        <div>{{ himentry.summary|striptags|nl2br }}</div>
                    {% else %}
                        <div><p>No summary yet.</p></div>
                    {% endif %}
                </div>
            </div>
        </div>

        {% if himentry.clienttags is defined and himentry.clienttags is not empty %}
        <div class="item-meta-secondary section">
            {% set himentrytags = himentry.clienttags|split(',') %}
            {% include 'items/_item-tags.twig' with {tags: himentrytags} %}
        </div>
        {% endif %}

        <div class="section">
            {% if himentry.description is defined  %}
                <div>{{ himentry.description|striptags|nl2br }}</div>
            {% else %}
                <div><p>No description yet.</p></div>
            {% endif %}
        </div>

        {% if himentry.upload_images is not empty %}
            <div class="section">
                <h3>Extra media</h3>
                <ul class="gallery_4">
                    {% for image in himentry.upload_images|default([]) %}
                        <li><img src="{{ image(image.filename) }}" alt="{{ image.title }}"></li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

    </div>
</div>

<div class="l-sidebar js-getstickywidth">
    {% if is_member() and not is_judge %}
        <div class="section account-detail-edit-this cf">
            <div class="account-item">
                <a href="/page/edit-a-heritage-in-motion-entry?id={{ currententryid }}" class="btn pill">Edit this Â»</a>
            </div>
        </div>

        {% include 'items/_item-profile-mini.twig' with { currentuser: currentuser, member: member|default(), member_meta: member_meta|default() } %}

    {% endif %}
    {% include 'items/_item-tags-large.twig' with {items: himentry.taxonomy.categories|default()} %}
</div>

<!-- End Main -->

<!-- End Content -->
{% else %}
    <div class="l-content">
        <div class="page_header">
            {% include 'items/_item-breadcrumb.twig' %}
        </div>

        <div id="entry-detail" class="entry-detail">
            <p>You need to <a href="/authentication/login">sign in</a> for this.</p>
        </div>
    </div>
    <div class="l-sidebar">
    </div>
{% endif %}
{% endblock %}
