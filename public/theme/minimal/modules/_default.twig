{% spaceless %}
{#
Available variables
    'module':    the full module object
    'title':     title of the module
    'subtitle':  subtitle of the module
    'body':      body of the module
    'records':   array of (selected) records that belong to the module
    'allow_pager': boolean to check is the pager is available
#}
{% set override_css_id = module.get('override_css_id') %}
{% set override_css_class = module.get('override_css_class') %}
{% set template = module.get('templates') %}
{% endspaceless %}
<section {% if override_css_id %}id="{{ override_css_id }}"{% endif %} class="module{%- if override_css_class %} {{ override_css_class }}{% endif -%}">

    {% if title is not empty %}
        <h2>{{ title }}</h2>
    {% endif %}

    {% if subtitle|default('') is not empty %}
        <p>{{ subtitle }}</p>
    {% endif %}

    {% if body is not empty %}
        {{ body|raw }}
    {% endif %}

    {% if records is iterable %}
        {% for record in records %}
            {% if record.id is defined %}
                {% set templatefile =  'views/_' ~ template ~ '_' ~ record.contenttype.slug ~ '.twig' %}
                {% set defaulttemplatefile =  'views/_' ~ template ~ '.twig' %}
                <!-- loading templatefile for record: '{{ templatefile }}' or '{{ defaulttemplatefile }}' or 'views/_fallback.twig' -->
                {% include [templatefile, defaulttemplatefile, 'views/_fallback.twig'] with { item: record, template: template } %}
            {% else %}
                <!-- selected record is unpublished or otherwise unavailable -->
            {% endif %}
        {% endfor %}

        {% set pagername = records|first.contenttype.slug|default('') %}
        {% if pagername is not empty and allow_pager == true %}
            {{ pager( pagername ) }}
        {% endif %}
    {% endif %}

</section>
