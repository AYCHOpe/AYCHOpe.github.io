{% spaceless %}
    {# This file might seem a little complex, because of the high density of tags.
       It uses Twig macros and ternary selectors. Read up on them, if required:
       macros: http://twig.sensiolabs.org/doc/templates.html#macros
       ternary operators: http://twig.sensiolabs.org/doc/templates.html#other-operators
    #}

    {# Make sure the setting for the submenus is defined. #}
    {% if withsubmenus is not defined %}
        {% set withsubmenus = true %}
    {% endif %}

    {# The 'recursive' macro, for inserting one menu item. If it has a submenu, it
       invokes itself to insert the items of the submenus. #}
    {% macro display_menu_item(item, loop, withsubmenus, level) %}
        {% from _self import display_menu_item %}
        {% spaceless %}
            <li class="index-{{ loop.index -}}
                {{ item.path|default('') == 'homepage' ? '' -}}
                {{ ' ' ~ item.class|default('') -}}
                {{ loop.first ? ' first' -}}
                {{ loop.last ? ' last' -}}
                {{ (level > 0) ? ' level-' ~ level -}}
                {{ (item.submenu|default(false) and withsubmenus) ? ' is-parent' -}}
                {{ item|current ? ' active' }}">

                <a href="{{ item.link }}" title='{{ item.title|default('')|escape }}'>
                    {{- item.label|default('-') -}}
                </a>

                {% if item.submenu is defined and withsubmenus %}
                    <ul class="sub-menu" data-submenu>
                        {% set sublevel = level+1 %}
                        {% for submenu in item.submenu %}
                            {{ display_menu_item(submenu, loop, withsubmenus, sublevel) }}
                        {% endfor %}
                    </ul>
                {% endif %}
            </li>
        {% endspaceless %}
    {% endmacro %}

    {# Make the macro available for use #}
    {% from _self import display_menu_item %}

    {# The main menu loop: Iterates over the items, calling `display_menu_item` #}
    {# we need all these classes for the jquery interactivity #}
    <ul class="play-menu" id="playmenu">
        {% for item in menu %}
            {% if item.label is defined %}
                {{ display_menu_item(item, loop, withsubmenus, 0) }}
            {% endif %}
        {% endfor %}
    </ul>

{% endspaceless %}

<style>
    /* base layout */
    #playmenu {
        top: 0;
        position: relative;
        width: 100%;
        z-index: 1;
    }
    #playmenu li.active.toplevel:not(.home) {
        min-height: 26em;
        margin-left: 0;
    }
    #playmenu li.last {
        border-bottom: 0;
    }
    #playmenu li.active.toplevel > a {
        min-height: 35px;
    }
    ul.play-menu > li:not(.home) {
        margin-left: 0px;
        padding-left: 35px;
    }
    ul.play-menu > li > .sub-menu {
        min-height: 23em;
    }
    ul.play-menu .sub-menu .sub-menu {
        display: none;
    }
    ul.play-menu .sub-menu li.active .sub-menu,
    ul.play-menu .sub-menu li:hover .sub-menu {
        display: block;
    }
    /* main menu item colours */
    #playmenu .home,
    ul.play-menu li.active.toplevel {
        padding-left: 0;
        background: #c4c4ba;
    }
    #playmenu .home a,
    ul.play-menu li.active.toplevel > a {
        color: #444;
        text-align: center;
        font-weight: normal;
        display: block;
    }

    /* menu structure */
    ul.play-menu a           { display: block; }
    ul.play-menu li          { padding-left: 25px; }
    ul.play-menu li > .sub-menu {
        margin: 5px 0 -12px 0;
        padding-left: 25px;
        border-left: none;
    }
    ul.play-menu li > .sub-menu .sub-menu {
        padding-left: 0;
        margin-left: 0;
    }
    ul.play-menu .sub-menu li {
        padding-left: 10px;
        border-left: none;
    }
    ul.play-menu .sub-menu .sub-menu {
        padding-bottom: 10px;
    }
    ul.play-menu .sub-menu .sub-menu li {
        padding: 2px 0;
        border-bottom: none;
    }
    ul.play-menu li.level-2 a {
        font-size: 90%;
    }
    /* mouseover thingies */
    ul.play-menu a:hover {
        font-weight: bold;
        letter-spacing: -0.5px;
    }
    .active > a {
        font-weight: bold;
        letter-spacing: -0.5px;
    }
    /* hackish way to add a marker
    .active:not(.toplevel):not(.home) > a:after {
        content: " ▶";
    }
    */

    /* the mouseover menu styles */
    nav #backlinks {
        background: #bcbabc;
    }
    nav #backlinks:hover {
        background: #fff;
    }
    #backlinks {
        top: 3.25em;
        position: absolute;
        width: 25px;
        overflow: hidden;
        z-index: 10;
        height: 22.75em;
        -webkit-transition: width 0.2s ease-in-out;
        -moz-transition: width 0.2s ease-in-out;
        -o-transition: width 0.2s ease-in-out;
        transition: width 0.2s ease-in-out;
    }
    #backlinks:before {
        content: "❰";
        font-weight: bold;
        color: #fff;
        top: 10em;
        padding: 5px;
        position: absolute;
    }
    #backlinks:hover {
        -webkit-transition: width 0.2s ease-in-out;
        -moz-transition: width 0.2s ease-in-out;
        -o-transition: width 0.2s ease-in-out;
        transition: width 0.2s ease-in-out;
        width: 100%;
    }
    #backlinks li {
        border-left: none;
        margin-left: 25px;
        padding-left: 10px;
    }
    #backlinks li.active {
        display: none;
    }

</style>
